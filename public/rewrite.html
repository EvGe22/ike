<html>
  <head>
    <title>Buildin' Them Electric Dictionaries</title>
    <script src="http://fb.me/react-0.12.2.js"></script>
    <script src="http://fb.me/JSXTransformer-0.12.2.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
  </head>
  <body>
    <div id="content"></div>
    <script type="text/jsx">
      var DictionaryApp = React.createClass({
        getInitialState: function() {
          return {
            query: ""
          };
        },
        handleChange: function(e) {
          this.setState({query: e.target.value});
        },
        render: function() {
          var query = this.state.query;
          return (
            <div>
              <InputBox query={query} handleChange={this.handleChange}/>
              <WordTokenInfos query={query} infos={this.props.data.wordTokenInfo} />
              <Results results={this.props.data.results}/>
            </div>
          );
        }
      });

      var InputBox = React.createClass({
        handleSubmit: function(e) {
          e.preventDefault();
        },
        render: function() {
          return (
            <form onSubmit={this.handleSubmit}>
              <input value={this.props.query} onChange={this.props.handleChange}/>
              <button>Submit</button>
            </form>
          );
        }
      });

      var WordTokenInfos = React.createClass({
        getInitialState: function() {
          return {infos: []};
        },
        componentDidMount: function() {
          var data = { query: this.props.query };
          var request = {
            type: "POST",
            url: "/api/wordTokenInfo",
            contentType: "application/json",
            data: JSON.stringify(data)
          };
          return $.ajax(request).success(function(results) {
            this.setState({infos: results});
          });
        },
        render: function() {
          var createInfo = function(i) {
            return <WordTokenInfo word={i.word} cluster={i.cluster} key={i.word}/>
          };
          return <ul>{this.state.infos.map(createInfo)}</ul>;
        }
      });

      var WordTokenInfo = React.createClass({
        render: function() {
          var word = this.props.word;
          var cluster = this.props.cluster;
          var max = cluster.length + 1;
          return (
            <li>
              <div>{word}</div>
              <ClusterDisplay cluster={cluster}/>
              <ClusterSlider max={max}/>
            </li>
          );
        }
      });

      var ClusterDisplay = React.createClass({
        render: function() {
          return <div>{this.props.cluster}</div>;
        }
      });

      var ClusterSlider = React.createClass({
        handleChange: function(e) {
        },
        render: function() {
          var max = this.props.max;
          return (
            <div>
              <input type="range" min="0" max={max} value={max} onChange={this.handleChange}/>
            </div>
          );
        }
      });

      var Results = React.createClass({
        render: function() {
          var createRow = function(row) {
            return <ResultsRow value={row.captureGroup} count={row.count} key={row.captureGroup}/>;
          }
          return <ul>{this.props.results.map(createRow)}</ul>;
        }
      });

      var ResultsRow = React.createClass({
        render: function() {
          return <li><div>{this.props.value}</div><div>{this.props.count}</div></li>;
        }
      });

      var data = {
        wordTokenInfo: [{ "word": "using", "cluster": "00011111110", "position": { "index": 0, "offset": [0, 5] } }, { "word": "information", "cluster": "10111111101", "position": { "index": 1, "offset": [7, 18] } }, { "word": "extraction", "cluster": "101111010010", "position": { "index": 2, "offset": [19, 29] } }],
        results: [{ "captureGroup": "information extraction", "count": 3 }]
      };

      React.render(<DictionaryApp data={data}/>, document.getElementById('content'));
    </script>
  </body>
</html>
